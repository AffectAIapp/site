<!doctype html>
<html lang="pt-br">

<head>
  <!-- Google Tag Manager -->
  <script>
    (function (w, d, s, l, i) {
      w[l] = w[l] || [];
      w[l].push({ 'gtm.start': new Date().getTime(), event: 'gtm.js' });
      var f = d.getElementsByTagName(s)[0],
        j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : '';
      j.async = true;
      j.src = 'https://www.googletagmanager.com/gtm.js?id=' + i + dl;
      f.parentNode.insertBefore(j, f);
    })(window, document, 'script', 'dataLayer', 'GTM-K9TFCGX9');
  </script>
  <!-- End Google Tag Manager -->

  <meta charset="utf-8" />
  <meta name="viewport"
    content="width=device-width, initial-scale=1, viewport-fit=cover, maximum-scale=1, user-scalable=no" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <title>AffectAI Chat</title>

  <style>
    :root {
      --purple: #7b73f1;
      --bg: #f6f5fa;
      --text: #1f2937;
      --muted: #6b7280;
      --shadow: 0 20px 40px rgba(15, 23, 42, .12);
      --radius: 22px;
      --font: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Inter, Helvetica, Arial;
      --safe-top: env(safe-area-inset-top, 0px);
      --safe-bottom: env(safe-area-inset-bottom, 0px);
      --vvh: 100vh;
    }

    * { box-sizing: border-box; }

    html, body {
      height: 100%;
      margin: 0;
      font-family: var(--font);
      background: var(--bg);
      color: var(--text);
      overflow: hidden;
      -webkit-text-size-adjust: 100%;
      touch-action: none;
    }

    @media (min-width: 900px) {
      body {
        background:
          radial-gradient(800px 520px at 50% 28%, rgba(123, 115, 241, .10), transparent 60%),
          radial-gradient(760px 520px at 50% 18%, rgba(255, 255, 255, .92), rgba(255, 255, 255, 0) 62%),
          var(--bg);
      }
    }

    .progress {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: #e5e7eb;
      z-index: 50;
    }

    .progress span {
      display: block;
      height: 100%;
      width: 100%;
      background: var(--purple);
    }

    .stage {
      height: var(--vvh);
      display: flex;
      justify-content: center;
      padding: calc(12px + var(--safe-top)) 12px calc(12px + var(--safe-bottom));
    }

    .column {
      width: 100%;
      max-width: 430px;
      display: flex;
      flex-direction: column;
      min-height: 0;
    }

    .frame {
      flex: 1 1 auto;
      min-height: 0;
      width: 100%;
      border-radius: 18px;
      overflow: hidden;
      box-shadow: 0 16px 38px rgba(15, 23, 42, .10);
      background: rgba(255, 255, 255, .78);
      border: 1px solid rgba(31, 41, 55, .08);
      position: relative;
    }

    .frame::before {
      content: "";
      position: absolute;
      inset: -90px -90px auto -90px;
      height: 180px;
      background: radial-gradient(closest-side, rgba(123, 115, 241, .14), transparent 70%);
      pointer-events: none;
      z-index: 1;
    }

    .frame-inner {
      position: relative;
      z-index: 2;
      height: 100%;
      width: 100%;
    }

    /* Impede qualquer scroll externo; o chat fica preso na área */
    .frame, .frame-inner {
      overscroll-behavior: none;
    }

    /* Para iOS: evita zoom por fonte pequena no host (o widget pode ter iframe interno) */
    body { font-size: 16px; }

    /* Se você usar o modo iframe abaixo, ele precisa ocupar 100% */
    .chat-iframe {
      border: 0;
      width: 100%;
      height: 100%;
      display: block;
      background: transparent;
    }
  </style>
</head>

<body>
  <!-- Google Tag Manager (noscript) -->
  <noscript>
    <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-K9TFCGX9" height="0" width="0"
      style="display:none;visibility:hidden"></iframe>
  </noscript>
  <!-- End Google Tag Manager (noscript) -->

  <div class="progress"><span></span></div>

  <main class="stage" id="stage">
    <div class="column">
      <section class="frame" aria-label="Chat">
        <div class="frame-inner" id="chatMount">

          <!-- OPÇÃO RECOMENDADA (script embed): reduz chance de zoom estranho no iOS -->
          <script
            chatbot_id="6960ea094e96c848acd0e419"
            data-type="default"
            src="https://app.thinkstack.ai/bot/thinkstackai-loader.min.js">
          </script>

          <!-- OPÇÃO ALTERNATIVA (iframe embed): use só se preferir.
               Atenção: se o Thinkstack renderizar inputs com fonte < 16px dentro do iframe,
               o iOS pode dar zoom mesmo assim. -->
          <!--
          <iframe
            class="chat-iframe"
            src="https://app.thinkstack.ai/bot/index.html?chatbot_id=6960ea094e96c848acd0e419&type=inline"
            allow="clipboard-read; clipboard-write"
            referrerpolicy="no-referrer-when-downgrade">
          </iframe>
          -->

        </div>
      </section>
    </div>
  </main>

  <script>
    // Ajuste de altura real no iOS (keyboard + barras do Safari)
    (function () {
      function setVVH() {
        var h = (window.visualViewport && window.visualViewport.height) ? window.visualViewport.height : window.innerHeight;
        document.documentElement.style.setProperty('--vvh', h + 'px');
      }

      setVVH();
      window.addEventListener('resize', setVVH, { passive: true });

      if (window.visualViewport) {
        window.visualViewport.addEventListener('resize', setVVH, { passive: true });
        window.visualViewport.addEventListener('scroll', function () {
          // Evita “empurrões” e volta o layout ao lugar após enviar
          window.scrollTo(0, 0);
        }, { passive: true });
      }

      // Garante que a página não fique "presa" com zoom após foco em input
      document.addEventListener('gesturestart', function (e) { e.preventDefault(); }, { passive: false });
      document.addEventListener('touchmove', function (e) { e.preventDefault(); }, { passive: false });
      window.addEventListener('focusin', function () { setVVH(); setTimeout(setVVH, 60); }, true);
      window.addEventListener('focusout', function () { setTimeout(function () { window.scrollTo(0, 0); setVVH(); }, 120); }, true);
    })();
  </script>
</body>

</html>
